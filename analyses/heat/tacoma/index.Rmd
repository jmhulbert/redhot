---
title: "Binomial Distribution Response to Urban Heat in Tacoma"
author: "Joey Hulbert"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


|            |            |            |            |            |
|:----------:|:----------:|:----------:|:----------:|:----------:|
|[Welcome](https://jmhulbert.github.io/redhot)|[Data](https://jmhulbert.github.io/redhot/data)|[Analyses](https://jmhulbert.github.io/redhot/analyses)|[Discussion](https://jmhulbert.github.io/redhot/discussion)|[Maps](https://jmhulbert.github.io/redhot/maps)
|             |           |            |            |            |


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(corrplot)
library(knitr)
library(kableExtra)
library(gghalves)
library(patchwork)
library(scales)
library(glmmTMB)
library(bbmle)
library(DHARMa)
```


# Purpose

The purpose of this page is to summarize an investigation of **tree health categories** as a *binary* response to urban heat (temperatures) for *trees within Tacoma*.

*Response variables*
Binary dead top: no top dieback, top dieback

![](https://github.com/jmhulbert/redhot/blob/main/maps/index_files/figure-html/tacoma-map-1.png?raw=true)


# Read Data

```{r}
data <- read.csv('https://raw.githubusercontent.com/jmhulbert/redhot/main/data/urban-data-modified.csv')
```

# Wrangle Data

## Remove dead trees

```{r}
# Remove Dead Trees
data.w.dead <- data 
data <- data %>% filter(field.tree.canopy.symptoms!="Tree is dead") %>% filter(field.dieback.percent<100) %>% droplevels()
```

```{r}
data$binary.tree.canopy.symptoms <- as.factor(data$binary.tree.canopy.symptoms)
levels(data$binary.tree.canopy.symptoms)
```

## Filter to Tacoma Data

```{r}
data <- data %>% filter(Area=="Tacoma") %>% droplevels()
```


# Visualize Tacoma Data

```{r}
ggplot(data,aes(binary.tree.canopy.symptoms,DN_AF1))+geom_violin()+coord_flip()+theme_bw()
```

```{r}
p1 <- ggplot(data,aes(binary.tree.canopy.symptoms))+geom_histogram(stat="count")+theme_bw()+coord_flip()
```

```{r}
p2 <- ggplot(data,aes(reclassified.tree.canopy.symptoms))+geom_histogram(stat="count")+theme_bw()+coord_flip()
```
```{r}
p1 + p2
```

```{r}
p3 <-ggplot(data,aes(binary.tree.canopy.symptoms,DN_AF1, fill=binary.tree.canopy.symptoms ))+geom_boxplot(alpha=0.5)+theme_bw()+coord_flip() + scale_fill_manual(name="Tree Condition",values=c("#7fcdbb","#fe9929"))+guides(fill=FALSE) +labs(x="Tree Condition",y=NULL)
```

```{r}
p4 <-ggplot(data,aes(DN_AF1,fill=binary.tree.canopy.symptoms))+geom_density(alpha=0.5) + scale_fill_manual(name="Tree Condition",values=c("#7fcdbb","#fe9929")) +theme_bw() +labs(x="Afternoon Temperature") +guides(fill=FALSE)
```

```{r}
p3 / p4
```


# Analyses

```{r}
data$top.dieback <- as.factor(data$top.dieback)
data$thinning <- as.factor(data$thinning)
```

## Fit Models

```{r}
binomial.daily <- glmmTMB(binary.tree.canopy.symptoms ~ mean.temp.daily ,family=binomial,data=data)
binomial.am <- glmmTMB(binary.tree.canopy.symptoms ~ DN_AM1 ,data=data,family=binomial)
binomial.af <- glmmTMB(binary.tree.canopy.symptoms ~ DN_AF1 ,data=data,family=binomial)
binomial.pm <- glmmTMB(binary.tree.canopy.symptoms ~ DN_PM1,data=data,family=binomial)
```

#### Best Fit Comparison

```{r}
AICtab(binomial.daily,binomial.am,binomial.af,binomial.pm)
```

PM was the best fit model for Tacoma trees


## Evening Temperatures

### Response 1.0: healthy / unhealthy

```{r}
binomial.PM <- glmmTMB(binary.tree.canopy.symptoms ~ DN_PM1,data=data,family=binomial)
```

#### Summary

```{r}
summary(binomial.PM)
```

```{r}
levels(data$binary.tree.canopy.symptoms)
```


### Response 2.0: healthy / top-dieback
```{r}
data.top <- data %>% filter(reclassified.tree.canopy.symptoms=="Healthy"|reclassified.tree.canopy.symptoms=="Dead Top") %>% droplevels()
```


```{r}
top.dieback.binomial.PM <- glmmTMB(top.dieback ~ DN_PM1,data=data.top,family=binomial)
```

#### Summary

```{r}
summary(top.dieback.binomial.PM)
```

```{r}
levels(data$top.dieback)
```


### Response 3.0: healthy / thinning

```{r}
data.thin <- data %>% filter(reclassified.tree.canopy.symptoms=="Healthy"|reclassified.tree.canopy.symptoms=="Thinning Canopy") %>% droplevels()
```


```{r}
thinning.binomial.PM <- glmmTMB(thinning ~ DN_PM1,data=data.thin,family=binomial)
```

#### Summary

```{r}
summary(thinning.binomial.PM)
```

```{r}
levels(data$thinning)
```





## Afternoon Temperatures

### Response 1.0: healthy / unhealthy

```{r}
binomial.af <- glmmTMB(binary.tree.canopy.symptoms ~ DN_AF1,data=data,family=binomial)
```

#### Summary

```{r}
summary(binomial.af)
```

```{r}
levels(data$binary.tree.canopy.symptoms)
```


### Response 2.0: healthy / top-dieback
```{r}
data.top <- data %>% filter(reclassified.tree.canopy.symptoms=="Healthy"|reclassified.tree.canopy.symptoms=="Dead Top") %>% droplevels()
```


```{r}
top.dieback.binomial.af <- glmmTMB(top.dieback ~ DN_AF1,data=data.top,family=binomial)
```

#### Summary

```{r}
summary(top.dieback.binomial.af)
```

```{r}
levels(data$top.dieback)
```


### Response 3.0: healthy / thinning

```{r}
data.thin <- data %>% filter(reclassified.tree.canopy.symptoms=="Healthy"|reclassified.tree.canopy.symptoms=="Thinning Canopy") %>% droplevels()
```


```{r}
thinning.binomial.af <- glmmTMB(thinning ~ DN_AF1,data=data.thin,family=binomial)
```

#### Summary

```{r}
summary(thinning.binomial.af)
```

```{r}
levels(data$thinning)
```


# Summary

There was no evidence for a relationship between tree health and afternoon temperatures in Tacoma.

